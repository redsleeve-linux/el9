From 94c7e260b499cd9e5ad8d99d95b9413df2d50cc6 Mon Sep 17 00:00:00 2001
From: Michal Sekletar <msekleta@redhat.com>
Date: Thu, 30 Mar 2023 14:56:16 +0200
Subject: [PATCH] rules: do not online CPU automatically on IBM platforms

RHEL-only

Resolves: #2143107
---
 rules.d/40-redhat.rules | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/rules.d/40-redhat.rules b/rules.d/40-redhat.rules
index 3c95cd2df0..efb866966e 100644
--- a/rules.d/40-redhat.rules
+++ b/rules.d/40-redhat.rules
@@ -1,7 +1,13 @@
 # do not edit this file, it will be overwritten on update
 
 # CPU hotadd request
-SUBSYSTEM=="cpu", ACTION=="add", TEST=="online", ATTR{online}=="0", ATTR{online}="1"
+SUBSYSTEM!="cpu", GOTO="cpu_online_end"
+ACTION!="add", GOTO="cpu_online_end"
+CONST{arch}=="s390*|ppc64*", GOTO="cpu_online_end"
+
+TEST=="online", ATTR{online}=="0", ATTR{online}="1"
+
+LABEL="cpu_online_end"
 
 # Memory hotadd request
 SUBSYSTEM!="memory", GOTO="memory_hotplug_end"
